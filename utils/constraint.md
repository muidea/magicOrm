# Constraint 标签解析规则手册 (Specification)

## 1. 语法规范 (Syntax)

标签字符串遵循以下微语法架构：

- **指令分隔符**: `,` (英文逗号)
- **键值分隔符**: `=` (等号)
- **参数分隔符**: `:` (冒号)

**示例格式：**
`constraint:"指令1,指令2=参数1,指令3=参数1:参数2"`

---

## 2. 解析逻辑说明

解析器在读取标签字符串时，应遵循以下逻辑顺序：

1. **分词 (Tokenization)**: 按 `,` 将字符串切分为多个指令单元。
2. **清洗 (Trimming)**: 移除每个指令单元前后的空格。
3. **映射 (Mapping)**: 识别 `=`。
    - 若无 `=`，则该指令视为 **布尔标记 (Flag)**，参数为空。
    - 若有 `=`，左侧为 **键 (Key)**，右侧按 `:` 切分为 **参数列表 (Args)**。

---

## 3. 指令集定义 (Directive Set)

### A. 访问行为约束 (Lifecycle & Permissions)

这类指令用于定义字段在业务流（如 API 输入输出、数据库 CRUD）中的行为特性。

| 指令 | 参数 | 描述 | 业务应用建议 |
| :--- | :--- | :--- | :--- |
| **`req`** | 无 | **Required**: 必填/必传 | 校验值不能为零值（0, "", nil）。 |
| **`ro`** | 无 | **Read-Only**: 只读 | 输出接口展示，但更新接口忽略此字段。 |
| **`wo`** | 无 | **Write-Only**: 只写 | 敏感字段（如密码），禁止在展示接口输出。 |
| **`imm`** | 无 | **Immutable**: 不可变 | 仅允许在 Create 时赋值，Update 时视为只读。 |

### B. 内容值约束 (Data Validation)

这类指令用于定义字段具体内容的合法性范围。

| 指令 | 参数示例 | 描述 |
| :--- | :--- | :--- |
| **`min`** | `min=1` | **最小值/最小长度**: 支持数字大小或字符串/数组长度。 |
| **`max`** | `max=100` | **最大值/最大长度**: 支持数字大小或字符串/数组长度。 |
| **`range`** | `range=1:100` | **区间约束**: 定义数值的闭区间范围 `[min, max]`。 |
| **`in`** | `in=A:B:C` | **枚举约束**: 字段值必须在定义的参数集合内。 |
| **`re`** | `re=^[a-z]+$` | **正则约束**: 字段值必须匹配指定的正则表达式。 |

---

## 5. 开发者示例

```go
type UserAccount struct {
    // ID 是必填且只读的
    ID       int    `constraint:"req,ro"`
    // 状态有默认值，且只能是 active 或 disabled 之一
    Status   string `constraint:"in=active:disabled"`
}
```
