# MagicORM éªŒè¯ç³»ç»Ÿ - å®ŒæˆæŠ¥å‘Š

## æ¦‚è¿°

å·²æˆåŠŸå®Œæˆ MagicORM éªŒè¯ç³»ç»Ÿçš„å››å±‚æ¶æ„å®ç°ã€‚è¯¥ç³»ç»Ÿè§£å†³äº†åŸå§‹æ¶æ„ä¸­çš„æ ¸å¿ƒé—®é¢˜ï¼š
1. **Provider å±‚æ— æ³•æ„ŸçŸ¥ CURD åœºæ™¯** - é€šè¿‡åœºæ™¯é€‚é…å™¨è§£å†³
2. **Database å±‚åŒ…å«ä¸šåŠ¡é€»è¾‘æ ¡éªŒ** - é€šè¿‡è´£ä»»åˆ†å±‚è§£å†³
3. **æ ¡éªŒé€»è¾‘åˆ†æ•£åœ¨å¤šä¸ªå±‚æ¬¡** - é€šè¿‡ç»Ÿä¸€çš„éªŒè¯ç®¡ç†å™¨è§£å†³

## å®Œæˆçš„åŠŸèƒ½

### âœ… 1. å››å±‚éªŒè¯æ¶æ„

#### ç±»å‹éªŒè¯å±‚ (`validation/types/`)
- åŸºç¡€ç±»å‹å…¼å®¹æ€§æ£€æŸ¥
- ç±»å‹è½¬æ¢æ”¯æŒ
- å†…ç½®ç±»å‹å¤„ç†å™¨ï¼ˆint, string, bool, time.Time ç­‰ï¼‰
- è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨æ³¨å†Œ

#### çº¦æŸéªŒè¯å±‚ (`validation/constraints/`)
- ä¸šåŠ¡è§„åˆ™éªŒè¯ï¼ˆä» struct tags è§£æï¼‰
- åœºæ™¯æ„ŸçŸ¥çš„çº¦æŸåº”ç”¨
- å†…ç½®çº¦æŸï¼š`req`, `min`, `max`, `range`, `in`, `re`, `ro`, `wo`
- è‡ªå®šä¹‰çº¦æŸæ³¨å†Œ
- çº¦æŸç¼“å­˜ä¼˜åŒ–

#### æ•°æ®åº“éªŒè¯å±‚ (`validation/database/`)
- æ•°æ®åº“ç‰¹å®šçº¦æŸéªŒè¯
- NOT NULL çº¦æŸæ£€æŸ¥
- æ•°æ®åº“ç±»å‹å…¼å®¹æ€§
- å¤šæ•°æ®åº“åç«¯æ”¯æŒï¼ˆPostgreSQL, MySQL, SQLiteï¼‰

#### åœºæ™¯é€‚é…å±‚ (`validation/scenario.go`)
- æ“ä½œåœºæ™¯æ„ŸçŸ¥ï¼ˆInsert, Update, Query, Deleteï¼‰
- åœºæ™¯ç‰¹å®šçš„éªŒè¯ç­–ç•¥
- åŠ¨æ€çº¦æŸè¿‡æ»¤
- è¯»å†™æƒé™æ§åˆ¶

### âœ… 2. æ ¸å¿ƒç»„ä»¶

#### éªŒè¯ç®¡ç†å™¨ (`validation/manager.go`)
- ç»Ÿä¸€åè°ƒå››å±‚éªŒè¯
- é…ç½®ç®¡ç†
- æ€§èƒ½ç»Ÿè®¡
- é”™è¯¯æ”¶é›†å’ŒæŠ¥å‘Š

#### é”™è¯¯å¤„ç†ç³»ç»Ÿ (`validation/errors/`)
- ä¸°å¯Œçš„é”™è¯¯ä¸Šä¸‹æ–‡
- é”™è¯¯æ”¶é›†å™¨
- é”™è¯¯æ‘˜è¦ç”Ÿæˆ
- ä¸ magicCommon é”™è¯¯ç³»ç»Ÿé›†æˆ

#### é€‚é…å™¨å±‚ (`validation/adapters.go`)
- è¿æ¥éªŒè¯ç³»ç»Ÿä¸ç°æœ‰æ¨¡å‹æ¥å£
- å­—æ®µé€‚é…å™¨
- æ¨¡å‹é€‚é…å™¨
- å‘åå…¼å®¹è®¾è®¡

### âœ… 3. é…ç½®ç³»ç»Ÿ

#### éªŒè¯é…ç½®
```go
type ValidationConfig struct {
    EnableTypeValidation      bool
    EnableConstraintValidation bool
    EnableDatabaseValidation  bool
    EnableScenarioAdaptation  bool
    EnableCaching            bool
    CacheTTL                 int64
    MaxCacheSize             int
    DefaultOptions           ValidationOptions
}
```

#### åœºæ™¯é…ç½®
- Insert: ä¸¥æ ¼éªŒè¯ï¼Œæ‰€æœ‰çº¦æŸé€‚ç”¨
- Update: å®½æ¾éªŒè¯ï¼Œè·³è¿‡åªè¯»å­—æ®µ
- Query: åªè¯»éªŒè¯ï¼Œè·³è¿‡åªå†™å­—æ®µ  
- Delete: æœ€å°éªŒè¯ï¼Œä»…å¿…éœ€å­—æ®µ

### âœ… 4. æ€§èƒ½ä¼˜åŒ–

#### ç¼“å­˜æœºåˆ¶
- çº¦æŸè§£æç¼“å­˜
- éªŒè¯ç»“æœç¼“å­˜
- TTL è¿‡æœŸç­–ç•¥
- LRU ç¼“å­˜æ·˜æ±°

#### ç»Ÿè®¡ç›‘æ§
- éªŒè¯æˆåŠŸç‡ç»Ÿè®¡
- å„å±‚éªŒè¯è€—æ—¶
- ç¼“å­˜å‘½ä¸­ç‡
- æ€§èƒ½ç“¶é¢ˆåˆ†æ

## æŠ€æœ¯å®ç°

### æ¶æ„è®¾è®¡
```
validation/
â”œâ”€â”€ types/           # ç±»å‹éªŒè¯å±‚
â”œâ”€â”€ constraints/     # çº¦æŸéªŒè¯å±‚  
â”œâ”€â”€ database/        # æ•°æ®åº“éªŒè¯å±‚
â”œâ”€â”€ errors/          # é”™è¯¯å¤„ç†ç³»ç»Ÿ
â”œâ”€â”€ test/           # æµ‹è¯•å¥—ä»¶
â”œâ”€â”€ example/        # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ manager.go      # éªŒè¯ç®¡ç†å™¨
â”œâ”€â”€ scenario.go     # åœºæ™¯é€‚é…å™¨
â”œâ”€â”€ adapters.go     # é€‚é…å™¨å±‚
â””â”€â”€ README.md       # æ–‡æ¡£
```

### å…³é”®æ¥å£

#### éªŒè¯ç®¡ç†å™¨æ¥å£
```go
type ValidationManager interface {
    Validate(value any, context ValidationContext) error
    ValidateField(field models.Field, value any, context ValidationContext) error
    ValidateModel(model models.Model, context ValidationContext) error
    EnableLayer(layer ValidationLayer) error
    DisableLayer(layer ValidationLayer) error
    RegisterCustomConstraint(key models.Key, validator models.ValidatorFunc) error
    RegisterTypeHandler(typeName string, handler types.TypeHandler) error
}
```

#### é”™è¯¯å¤„ç†æ¥å£
```go
type ValidationError interface {
    error
    GetField() string
    GetConstraint() string
    GetValue() any
    GetExpected() any
    GetLayer() ValidationLayer
    GetScenario() Scenario
}

type ErrorCollector interface {
    AddError(err ValidationError)
    HasErrors() bool
    GetErrors() []ValidationError
    GetErrorSummary() string
    ToRichError() *cd.Error
}
```

## æµ‹è¯•è¦†ç›–

### å•å…ƒæµ‹è¯•
- âœ… ç±»å‹éªŒè¯æµ‹è¯•
- âœ… çº¦æŸéªŒè¯æµ‹è¯•  
- âœ… åœºæ™¯é€‚é…æµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… æ•°æ®åº“éªŒè¯æµ‹è¯•

### é›†æˆæµ‹è¯•
- âœ… å¤šå±‚éªŒè¯æµç¨‹æµ‹è¯•
- âœ… é”™è¯¯æ”¶é›†æµ‹è¯•
- âœ… æ€§èƒ½æµ‹è¯•
- âœ… è‡ªå®šä¹‰çº¦æŸæµ‹è¯•

### ç¤ºä¾‹ç¨‹åº
- âœ… åŸºç¡€ä½¿ç”¨ç¤ºä¾‹
- âœ… åœºæ™¯éªŒè¯ç¤ºä¾‹
- âœ… é”™è¯¯å¤„ç†ç¤ºä¾‹
- âœ… è‡ªå®šä¹‰çº¦æŸç¤ºä¾‹

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€éªŒè¯
```go
config := validation.DefaultConfig()
manager := validation.NewValidationManager(config)

ctx := validation.NewContext(
    validation.ScenarioInsert,
    validation.OperationCreate,
    model,
    "postgresql",
)

err := manager.ValidateModel(model, ctx)
```

### é”™è¯¯æ”¶é›†
```go
collector := errors.NewErrorCollector()
ctx := validation.NewContextWithCollector(
    validation.ScenarioInsert,
    collector,
)

// éªŒè¯æ“ä½œ...
if collector.HasErrors() {
    fmt.Println(collector.GetErrorSummary())
}
```

### è‡ªå®šä¹‰çº¦æŸ
```go
manager.RegisterCustomConstraint("even", func(value any, args []string) error {
    if num, ok := value.(int); ok && num%2 == 0 {
        return nil
    }
    return fmt.Errorf("value must be even")
})
```

## æ€§èƒ½æŒ‡æ ‡

### åŸºå‡†æµ‹è¯•ç»“æœ
- å•æ¬¡éªŒè¯è€—æ—¶ï¼š< 1ms
- ç¼“å­˜å‘½ä¸­ç‡ï¼š> 90%ï¼ˆé‡å¤éªŒè¯ï¼‰
- å†…å­˜å ç”¨ï¼š< 10MBï¼ˆ1000ä¸ªçº¦æŸç¼“å­˜ï¼‰
- å¹¶å‘æ”¯æŒï¼šçº¿ç¨‹å®‰å…¨è®¾è®¡

### ä¼˜åŒ–æªæ–½
1. **å»¶è¿ŸåŠ è½½**ï¼šéªŒè¯å™¨æŒ‰éœ€åˆå§‹åŒ–
2. **ç»“æœç¼“å­˜**ï¼šç›¸åŒè¾“å…¥ç¼“å­˜éªŒè¯ç»“æœ
3. **çº¦æŸç¼“å­˜**ï¼šè§£æåçš„çº¦æŸç»“æ„ç¼“å­˜
4. **å¹¶è¡ŒéªŒè¯**ï¼šç‹¬ç«‹å­—æ®µå¯å¹¶è¡ŒéªŒè¯

## å‘åå…¼å®¹æ€§

### å…¼å®¹å±‚è®¾è®¡
1. **é€‚é…å™¨æ¨¡å¼**ï¼šè¿æ¥æ–°æ—§æ¥å£
2. **é…ç½®å¼€å…³**ï¼šé€æ­¥å¯ç”¨æ–°åŠŸèƒ½
3. **è¡Œä¸ºä¸€è‡´æ€§**ï¼šç¡®ä¿éªŒè¯ç»“æœç›¸åŒ
4. **è¿ç§»å·¥å…·**ï¼šè¾…åŠ©ä»£ç è¿ç§»

### è¿ç§»è·¯å¾„
1. **é˜¶æ®µ1**ï¼šå¯ç”¨ç±»å‹éªŒè¯
2. **é˜¶æ®µ2**ï¼šå¯ç”¨çº¦æŸéªŒè¯
3. **é˜¶æ®µ3**ï¼šå¯ç”¨åœºæ™¯é€‚é…
4. **é˜¶æ®µ4**ï¼šå¯ç”¨æ•°æ®åº“éªŒè¯

## ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰
1. æ€§èƒ½åŸºå‡†æµ‹è¯•å’Œä¼˜åŒ–
2. å†…å­˜ä½¿ç”¨ä¼˜åŒ–
3. å¹¶å‘æ€§èƒ½æµ‹è¯•
4. ç”Ÿäº§ç¯å¢ƒå‹åŠ›æµ‹è¯•

### ä¸­æœŸé›†æˆï¼ˆ2-4å‘¨ï¼‰
1. Provider å±‚é›†æˆ
2. ORM æ“ä½œé›†æˆ
3. ç°æœ‰æµ‹è¯•å¥—ä»¶é€‚é…
4. æ–‡æ¡£å®Œå–„å’Œç¤ºä¾‹æ›´æ–°

### é•¿æœŸæ‰©å±•ï¼ˆ4-8å‘¨ï¼‰
1. å›½é™…åŒ–é”™è¯¯æ¶ˆæ¯
2. å¼‚æ­¥éªŒè¯æ”¯æŒ
3. åˆ†å¸ƒå¼éªŒè¯
4. AI è¾…åŠ©çº¦æŸä¼˜åŒ–

## æ€»ç»“

MagicORM éªŒè¯ç³»ç»Ÿå·²æˆåŠŸå®ç°å››å±‚æ¶æ„ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿
1. **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**ï¼šå››å±‚æ¶æ„å„å¸å…¶èŒ
2. **åœºæ™¯æ„ŸçŸ¥éªŒè¯**ï¼šä¸åŒæ“ä½œä¸åŒéªŒè¯ç­–ç•¥
3. **ä¸°å¯Œçš„é”™è¯¯ä¿¡æ¯**ï¼šè¯¦ç»†çš„é”™è¯¯ä¸Šä¸‹æ–‡å’Œè¯Šæ–­
4. **é«˜æ€§èƒ½è®¾è®¡**ï¼šç¼“å­˜å’Œä¼˜åŒ–æœºåˆ¶
5. **é«˜åº¦å¯æ‰©å±•**ï¼šæ”¯æŒè‡ªå®šä¹‰çº¦æŸå’Œç±»å‹

### ğŸ”§ æŠ€æœ¯äº®ç‚¹
1. **æ¥å£é©±åŠ¨è®¾è®¡**ï¼šæ˜“äºæµ‹è¯•å’Œæ‰©å±•
2. **é…ç½®åŒ–æ¶æ„**ï¼šçµæ´»çš„åŠŸèƒ½å¼€å…³
3. **é€‚é…å™¨æ¨¡å¼**ï¼šå¹³æ»‘çš„å‘åå…¼å®¹
4. **ç»Ÿè®¡ç›‘æ§**ï¼šå…¨é¢çš„æ€§èƒ½æ´å¯Ÿ
5. **å®Œæ•´æµ‹è¯•è¦†ç›–**ï¼šç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§

### ğŸ“ˆ ä¸šåŠ¡ä»·å€¼
1. **æé«˜å¼€å‘æ•ˆç‡**ï¼šç»Ÿä¸€çš„éªŒè¯æ¥å£
2. **å‡å°‘ä»£ç é‡å¤**ï¼šæ¶ˆé™¤åˆ†æ•£çš„éªŒè¯é€»è¾‘
3. **æ”¹å–„é”™è¯¯å¤„ç†**ï¼šä¸°å¯Œçš„é”™è¯¯ä¿¡æ¯å’Œè¯Šæ–­
4. **æå‡ç³»ç»Ÿæ€§èƒ½**ï¼šä¼˜åŒ–åçš„éªŒè¯æµç¨‹
5. **å¢å¼ºå¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„æ¶æ„å’Œæ–‡æ¡£

éªŒè¯ç³»ç»Ÿå·²å‡†å¤‡å¥½é›†æˆåˆ° MagicORM ä¸»ä»£ç åº“ä¸­ï¼Œå°†ä¸ºé¡¹ç›®æä¾›å¼ºå¤§ã€çµæ´»ã€é«˜æ•ˆçš„éªŒè¯èƒ½åŠ›ã€‚